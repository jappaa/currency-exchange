<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/services/api/bank.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">All files</a> / <a href="index.html">src/services/api</a> bank.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">3.23% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>1/31</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">3.45% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>1/29</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { Schema, arrayOf, normalize } from 'normalizr'
import { camelizeKeys } from 'humps'
import 'isomorphic-fetch'
import config from '../../config'
import { currencies } from '../../../assets/data/currenciesMaster'
import {
  getBanksSortByCurrency,
} from '../../modules/currencyPopular/selectors'
&nbsp;
import { number } from '../../services'
import { currency } from '../../helpers'
&nbsp;
async function <span class="fstat-no" title="function not covered" >callBankApi </span>( endpoint ) {
  let fullUrl = <span class="cstat-no" title="statement not covered" >endpoint.indexOf( config.apiBank.proxy ) === -1</span>
    ? `${ config.apiBank.proxy }/${ endpoint }`
    : endpoint
&nbsp;
<span class="cstat-no" title="statement not covered" >  if ( __SERVER__ ) {</span>
<span class="cstat-no" title="statement not covered" >    fullUrl = endpoint.indexOf( config.apiBank.endpoint ) === -1</span>
      ? `${ config.apiBank.endpoint }/${ endpoint }`
      : endpoint
  }
<span class="cstat-no" title="statement not covered" >  return fetch( fullUrl )</span>
    .then( <span class="fstat-no" title="function not covered" >re</span>sponse =&gt; <span class="cstat-no" title="statement not covered" >response.json().then( <span class="fstat-no" title="function not covered" >js</span>on =&gt; ( <span class="cstat-no" title="statement not covered" >{ json, response } </span>) ) </span>)
    .then( <span class="fstat-no" title="function not covered" >( </span>{ json, response } ) =&gt; {
<span class="cstat-no" title="statement not covered" >      if ( !response.ok ) {</span>
<span class="cstat-no" title="statement not covered" >        return Promise.reject( json )</span>
      }
<span class="cstat-no" title="statement not covered" >      return camelizeKeys( json )</span>
    } )
    .then( <span class="fstat-no" title="function not covered" >ca</span>melizedJson =&gt;
<span class="cstat-no" title="statement not covered" >      camelizedJson.reduce(</span>
<span class="fstat-no" title="function not covered" >        ( </span>p, c ) =&gt; {
          const specific = <span class="cstat-no" title="statement not covered" >c.data.reduce(</span>
<span class="fstat-no" title="function not covered" >            ( </span>p, c ) =&gt; {
<span class="cstat-no" title="statement not covered" >              if ( c.acronym.indexOf( 'JPY' ) !== -1 ) {</span>
<span class="cstat-no" title="statement not covered" >                return currency.currencyDivide( currencies, p, c, 'JPY' )</span>
              } else <span class="cstat-no" title="statement not covered" >if ( c.acronym.indexOf( 'KRW' ) !== -1 ) {</span>
<span class="cstat-no" title="statement not covered" >                return currency.currencyDivide( currencies, p, c, 'KRW' )</span>
              } else <span class="cstat-no" title="statement not covered" >if ( c.acronym.indexOf( 'IDR' ) !== -1 ) {</span>
<span class="cstat-no" title="statement not covered" >                return currency.currencyDivide( currencies, p, c, 'IDR' )</span>
              } else {
<span class="cstat-no" title="statement not covered" >                return [</span>
                  ...p,
                  {
                    ...c,
                    extendName: null,
                    currencyDetails: currencies[ c.acronym.substr( 0, 3 ) ],
                    indexGroup: 0,
                    sell: +c.sell,
                    buy: +c.buy,
                  },
                ]
              }
            },
            [],
          )
          const usdCase = <span class="cstat-no" title="statement not covered" >c.data</span>
            .filter( <span class="fstat-no" title="function not covered" >e </span>=&gt; <span class="cstat-no" title="statement not covered" >e.acronym.indexOf( 'USD' ) !== -1 </span>)
            .sort( <span class="fstat-no" title="function not covered" >( </span>a, b ) =&gt; <span class="cstat-no" title="statement not covered" >a.sell - b.sell </span>)
            .map( <span class="fstat-no" title="function not covered" >( </span>e, k ) =&gt; ( <span class="cstat-no" title="statement not covered" >{</span>
              ...e,
              acronym: `USD${ k + 1 }`,
              extendName: currency.usdExtendName[ k ].text,
              currencyDetails: currencies[ 'USD' ],
              indexGroup: k,
              sell: +e.sell,
              buy: +e.buy,
            } ) )
&nbsp;
<span class="cstat-no" title="statement not covered" >          return [</span>
            ...p,
            {
              ...c,
              data: [ ...specific, ...usdCase ],
              isTotal: true,
              ...[ ...specific, ...usdCase ].reduce( <span class="fstat-no" title="function not covered" >(</span>
                p,
                c, // TODO: case usd fix
              ) =&gt;
<span class="cstat-no" title="statement not covered" >                c.acronym.indexOf( 'USD' ) === -1</span>
                  ? { ...p, [ c.currencyDetails.code ]: c }
                  : { ...p, [ c.acronym ]: c }, {} ),
            },
          ]
        },
        [],
      ) )
    .then( <span class="fstat-no" title="function not covered" >co</span>mplutedData =&gt; {
      const popularCurrenciesComputed = <span class="cstat-no" title="statement not covered" >currency.injectCurrency(</span>
        currency.defaultCurrenciesPopular(),
        'USD',
      )
      const popular = <span class="cstat-no" title="statement not covered" >getBanksSortByCurrency(</span>
        {
          entities: { banks: complutedData },
        },
        currencies,
        popularCurrenciesComputed,
      )
&nbsp;
<span class="cstat-no" title="statement not covered" >      return {</span>
        response: { entities: { banks: popular } },
      }
    } )
    .then(
<span class="fstat-no" title="function not covered" >      re</span>sponse =&gt; <span class="cstat-no" title="statement not covered" >response,</span>
<span class="fstat-no" title="function not covered" >      er</span>ror =&gt; ( <span class="cstat-no" title="statement not covered" >{</span>
        error: error.message || 'Something bad happened.',
      } ),
    )
}
&nbsp;
const fetchBanks = <span class="fstat-no" title="function not covered" >()</span> =&gt; <span class="cstat-no" title="statement not covered" >callBankApi( 'bank' )</span>
&nbsp;
export { fetchBanks }
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Mar 30 2017 03:18:49 GMT+0700 (ICT)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
